---
title: "Simulate PID data"
author: "Phillip Labuschagne"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
n_rna <- 100
pid_length <- 8
left_primer_prefix <- 'GAGGAGATATG'
left_primer_suffix <- 'AGGGACAATTG'
right_primer <- 'AGGGACAATTGGAGAAGTGAA'
```

This vignette demonstrates how YASSS can be used to simulate PID data.

Steps:

- Simulate quasispecies / population.
- Generate PIDs.
- Attach PIDs to quasispecies combined with a sampling procedure.
- Simulate PCR.
- Sample from PCR product to get bin distribution.
- Add in a level of recombination.

### Simulate quasispecies

Given a piece of HXB2, just run the basic functionality of YASSS to get a quasispecies. (Manipulating the parameters a bit for illustrative purposes)

```{r}
# env from 6300 to ~7600 # chopped some for primer mats
# ty lanl as always
HXB2 <- 'TGATCTGTAGTGCTACAGAAAAATTGTGGGTCACAGTCTATTATGGGGTACCTGTGTGGAAGGAAGCAACCACCACTCTATTTTGTGCATCAGATGCTAAAGCATATGATACAGAGGTACATAATGTTTGGGCCACACATGCCTGTGTACCCACAGACCCCAACCCACAAGAAGTAGTATTGGTAAATGTGACAGAAAATTTTAACATGTGGAAAAATGACATGGTAGAACAGATGCATGAGGATATAATCAGTTTATGGGATCAAAGCCTAAAGCCATGTGTAAAATTAACCCCACTCTGTGTTAGTTTAAAGTGCACTGATTTGAAGAATGATACTAATACCAATAGTAGTAGCGGGAGAATGATAATGGAGAAAGGAGAGATAAAAAACTGCTCTTTCAATATCAGCACAAGCATAAGAGGTAAGGTGCAGAAAGAATATGCATTTTTTTATAAACTTGATATAATACCAATAGATAATGATACTACCAGCTATAAGTTGACAAGTTGTAACACCTCAGTCATTACACAGGCCTGTCCAAAGGTATCCTTTGAGCCAATTCCCATACATTATTGTGCCCCGGCTGGTTTTGCGATTCTAAAATGTAATAATAAGACGTTCAATGGAACAGGACCATGTACAAATGTCAGCACAGTACAATGTACACATGGAATTAGGCCAGTAGTATCAACTCAACTGCTGTTAAATGGCAGTCTAGCAGAAGAAGAGGTAGTAATTAGATCTGTCAATTTCACGGACAATGCTAAAACCATAATAGTACAGCTGAACACATCTGTAGAAATTAATTGTACAAGACCCAACAACAATACAAGAAAAAGAATCCGTATCCAGAGAGGACCAGGGAGAGCATTTGTTACAATAGGAAAAATAGGAAATATGAGACAAGCACATTGTAACATTAGTAGAGCAAAATGGAATAACACTTTAAAACAGATAGCTAGCAAATTAAGAGAACAATTTGGAAATAATAAAACAATAATCTTTAAGCAATCCTCAGGAGGGGACCCAGAAATTGTAACGCACAGTTTTAATTGTGGAGGGGAATTTTTCTACTGTAATTCAACACAACTGTTTAATAGTACTTGGTTTAATAGTACTTGGAGTACTGAAGGGTCAAATAACACTGAAGGAAGTGACACAATCACCCTCCCATGCAGAATAAAACAAATTATAAACATGTGGCAGAAAGTAGGAAAAGCAATGTATGCCCCTCCCATCAGTGGACAAATTAGATGTTCATCAAATATTACAGGGCTGCTATTAACAAGAGATGGTGGTAATAGCAACAATGAGTCCGAGATCTTCAGACCTGGAG'

#qs = short for quasispecies
qs <- sim_pop(ancestors = substr(HXB2, 200, 700),
              r0 = n_rna,
              n_gen = 1,
              n_pop = Inf,
              mutator = list(fun = "mutator_uniform_fun",
                             args = list(mu = 0.05)),
              fitness_evaluator = list(fun = "fitness_evaluator_uniform_fun",
                                       args = NULL))
```

### Generate PIDs

```{r}
pids <-
apply(matrix(sample(c('A', 'C', 'G', 'T'), 
                    n_rna * pid_length, 
                    replace = TRUE),
             ncol = pid_length,
             nrow = n_rna),
      1,
      paste0, 
      collapse = '')
```

### Attach PIDs

```{r}
the_seq <- qs %>% 
  filter(gen_num == 1) %>% 
  select(the_seq)

the_seq <- the_seq[,1,drop=TRUE]

primed_seqs <- paste0(left_primer_prefix, pids, left_primer_suffix, the_seq, right_primer)
```




